<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Wise Townships Comparison - Alexandra vs Soweto</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --alexandra-blue: #0066cc;
            --soweto-green: #1a472a;
            --soweto-gold: #FFD700;
            --light-blue: #e6f2ff;
            --light-green: #e6f2e6;
            --white: #ffffff;
            --text-dark: #333333;
            --success-green: #28a745;
            --warning-orange: #ffc107;
            --danger-red: #dc3545;
            --accent-purple: #6f42c1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e7eb 100%);
            min-height: 100vh;
            overflow-x: hidden;
            color: var(--text-dark);
            line-height: 1.6;
            position: relative;
        }

        .water-drop {
            position: fixed;
            top: -10%;
            width: 15px;
            height: 15px;
            background: rgba(0, 102, 204, 0.2);
            border-radius: 50% 50% 50% 0;
            transform: rotate(45deg);
            animation: fall linear infinite;
            pointer-events: none;
            z-index: 1;
        }

        .water-drop.green {
            background: rgba(26, 71, 42, 0.2);
        }

        @keyframes fall {
            to {
                top: 110%;
                opacity: 0;
            }
        }

        .dashboard {
            position: relative;
            z-index: 2;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            position: relative;
            padding: 40px;
            background: linear-gradient(135deg, var(--alexandra-blue) 0%, var(--soweto-green) 100%);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .logo {
            font-size: 3rem;
            color: white;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            color: white;
        }

        .header h2 {
            font-size: 1.5rem;
            font-weight: 500;
            opacity: 0.9;
            margin-bottom: 15px;
            color: white;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 15px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            color: white;
        }

        .date-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
        }

        .pulse-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--soweto-gold);
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.5;
                transform: scale(1.3);
            }
        }

        .data-update-badge {
            background: linear-gradient(135deg, var(--soweto-gold), #ffed4e);
            color: var(--soweto-green);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 10px;
            display: inline-block;
            font-weight: bold;
            animation: newDataPulse 2s infinite;
        }

        @keyframes newDataPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: all 0.4s ease;
            border: 1px solid rgba(255, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
        }

        .stat-card.alexandra {
            border-top: 4px solid var(--alexandra-blue);
        }

        .stat-card.soweto {
            border-top: 4px solid var(--soweto-green);
        }

        .stat-card.comparison {
            border-top: 4px solid var(--accent-purple);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .stat-card.alexandra .stat-icon { color: var(--alexandra-blue); }
        .stat-card.soweto .stat-icon { color: var(--soweto-green); }
        .stat-card.comparison .stat-icon { color: var(--accent-purple); }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
            font-variant-numeric: tabular-nums;
        }

        .stat-card.alexandra .stat-value { color: var(--alexandra-blue); }
        .stat-card.soweto .stat-value { color: var(--soweto-green); }
        .stat-card.comparison .stat-value { color: var(--accent-purple); }

        .stat-label {
            font-size: 0.95rem;
            color: #718096;
            font-weight: 500;
        }

        .township-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .badge-alexandra {
            background-color: var(--alexandra-blue);
            color: white;
        }

        .badge-soweto {
            background-color: var(--soweto-green);
            color: white;
        }

        .nav-pills .nav-link {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 0 5px;
        }

        .nav-pills .nav-link:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .nav-pills .nav-link.active {
            background: rgba(255, 255, 255, 0.3) !important;
            color: white !important;
            border-color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .nav-pills .nav-link i {
            color: white;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: all 0.4s ease;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            padding-bottom: 10px;
        }

        .card-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            background: linear-gradient(90deg, var(--alexandra-blue), var(--soweto-green));
            border-radius: 2px;
        }

        .chart-container {
            position: relative;
            height: 250px;
        }

        .comparison-card {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 5px solid var(--accent-purple);
        }

        .comparison-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dashed #e2e8f0;
        }

        .comparison-item:last-child {
            border-bottom: none;
        }

        .section-header {
            text-align: center;
            color: white;
            margin: 40px 0 20px;
            padding: 20px;
            background: linear-gradient(135deg, var(--alexandra-blue) 0%, var(--soweto-green) 100%);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .section-header h2 {
            color: white;
        }

        .section-header p {
            color: white;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .btn-custom {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-custom:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .pdf-btn {
            background: linear-gradient(135deg, var(--alexandra-blue), var(--soweto-green));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .pdf-btn:hover {
            background: linear-gradient(135deg, var(--soweto-green), var(--alexandra-blue));
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Mobile Responsive Fixes */
        @media (max-width: 768px) {
            .nav-pills {
                flex-direction: column !important;
                align-items: stretch !important;
                width: 100% !important;
            }
            
            .nav-item {
                width: 100% !important;
                margin-bottom: 8px !important;
            }
            
            .nav-pills .nav-link {
                color: #333 !important;
                background: rgba(255, 255, 255, 0.95) !important;
                border: 2px solid var(--alexandra-blue) !important;
                font-weight: 600;
                width: 100% !important;
                text-align: center !important;
                padding: 12px !important;
                margin: 0 0 8px 0 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 8px !important;
            }
            
            .nav-pills .nav-link i {
                color: #333 !important;
            }
            
            .nav-pills .nav-link.active {
                background: var(--alexandra-blue) !important;
                color: white !important;
                border-color: var(--alexandra-blue) !important;
            }
            
            .nav-pills .nav-link.active i {
                color: white !important;
            }
            
            .header .d-flex.justify-content-center.gap-3.flex-wrap {
                flex-direction: column !important;
                gap: 10px !important;
                width: 100% !important;
            }
            
            .btn-custom, .pdf-btn {
                width: 100% !important;
                padding: 12px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 8px !important;
            }
            
            .btn-custom {
                color: #333 !important;
                background: rgba(255, 255, 255, 0.95) !important;
                border: 2px solid var(--alexandra-blue) !important;
            }
            
            .btn-custom i {
                color: #333 !important;
            }
            
            .pdf-btn {
                background: linear-gradient(135deg, var(--alexandra-blue), var(--soweto-green)) !important;
                color: white !important;
                border: 2px solid var(--alexandra-blue) !important;
            }
            
            .pdf-btn i {
                color: white !important;
            }
            
            .date-badge {
                color: #333 !important;
                background: rgba(255, 255, 255, 0.95) !important;
                border: 2px solid var(--alexandra-blue) !important;
                font-size: 0.9rem !important;
                padding: 10px 15px !important;
                margin-top: 15px !important;
            }
            
            .date-badge .pulse-dot {
                background: #333 !important;
            }
            
            .data-update-badge {
                font-size: 0.8rem !important;
                padding: 8px 12px !important;
            }
            
            .header {
                padding: 20px 15px !important;
            }
            
            .header h1 {
                font-size: 1.8rem !important;
            }
            
            .header h2 {
                font-size: 1.2rem !important;
            }
            
            .header p {
                font-size: 0.95rem !important;
            }
            
            .quick-stats {
                grid-template-columns: 1fr !important;
                gap: 15px;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-value {
                font-size: 2rem;
            }
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .insights-list {
            list-style-type: none;
            padding-left: 0;
        }

        .insights-list li {
            padding: 10px 0;
            border-bottom: 1px dashed #e2e8f0;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .insights-list li:last-child {
            border-bottom: none;
        }

        .alexandra-color {
            color: var(--alexandra-blue);
            font-weight: bold;
        }

        .soweto-color {
            color: var(--soweto-green);
            font-weight: bold;
        }

        .difference-positive {
            color: var(--success-green);
            font-weight: bold;
        }

        .difference-negative {
            color: var(--danger-red);
            font-weight: bold;
        }

        .progress {
            height: 10px;
            border-radius: 5px;
        }

        .progress-bar-alexandra {
            background-color: var(--alexandra-blue);
        }

        .progress-bar-soweto {
            background-color: var(--soweto-green);
        }
    </style>
</head>
<body>
    <!-- Water Droplets Background -->
    <div id="waterDrops"></div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="dashboard container-fluid py-4">
        <div class="header">
            <div class="logo-container">
                <i class="fas fa-tint logo"></i>
                <h1>Rand Water Townships Comparison</h1>
            </div>
            <h2>Alexandra vs Soweto - Comprehensive Analysis</h2>
            <p>Comparative analysis of water challenges, community engagement, and conservation awareness in Alexandra (85 surveys) and Soweto (60 surveys). Identify common patterns and township-specific issues.</p>
            <div class="date-badge">
                <span class="pulse-dot"></span>Data Sources: Alexandra (85 surveys) + Soweto (60 surveys) = 145 Total Surveys
            </div>
            <div class="data-update-badge">
                <i class="fas fa-chart-bar"></i> Comparative Analysis: October 2025 Data
            </div>
            
            <!-- Navigation Tabs -->
            <ul class="nav nav-pills justify-content-center mt-4 mb-3 flex-wrap" id="reportTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="overview-tab" data-bs-toggle="pill" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">
                        <i class="fas fa-chart-pie"></i> Overview
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="comparison-tab" data-bs-toggle="pill" data-bs-target="#comparison" type="button" role="tab" aria-controls="comparison" aria-selected="false">
                        <i class="fas fa-balance-scale"></i> Side-by-Side
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="issues-tab" data-bs-toggle="pill" data-bs-target="#issues" type="button" role="tab" aria-controls="issues" aria-selected="false">
                        <i class="fas fa-exclamation-triangle"></i> Key Issues
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="solutions-tab" data-bs-toggle="pill" data-bs-target="#solutions" type="button" role="tab" aria-controls="solutions" aria-selected="false">
                        <i class="fas fa-lightbulb"></i> Solutions
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="data-tab" data-bs-toggle="pill" data-bs-target="#data" type="button" role="tab" aria-controls="data" aria-selected="false">
                        <i class="fas fa-database"></i> Data Analysis
                    </button>
                </li>
            </ul>
            
            <div class="d-flex justify-content-center gap-3 flex-wrap mt-3">
                <button class="btn btn-custom" id="printBtn">
                    <i class="fas fa-print"></i> Print Report
                </button>
                <button class="btn btn-custom" id="downloadBtn">
                    <i class="fas fa-download"></i> Download Data
                </button>
                <button class="btn btn-custom" id="shareBtn" data-bs-toggle="modal" data-bs-target="#shareModal">
                    <i class="fas fa-share-alt"></i> Share Report
                </button>
                <button class="btn pdf-btn" id="pdfBtn" data-bs-toggle="modal" data-bs-target="#pdfModal">
                    <i class="fas fa-file-pdf"></i> PDF Report
                </button>
            </div>
        </div>

        <!-- Quick Stats Dashboard -->
        <div class="quick-stats">
            <div class="stat-card alexandra">
                <div class="township-badge badge-alexandra">Alexandra</div>
                <div class="stat-icon"><i class="fas fa-users"></i></div>
                <div class="stat-value">85</div>
                <div class="stat-label">Survey Responses</div>
                <div class="progress mt-2">
                    <div class="progress-bar progress-bar-alexandra" style="width: 100%"></div>
                </div>
            </div>
            
            <div class="stat-card soweto">
                <div class="township-badge badge-soweto">Soweto</div>
                <div class="stat-icon"><i class="fas fa-users"></i></div>
                <div class="stat-value">60</div>
                <div class="stat-label">Survey Responses</div>
                <div class="progress mt-2">
                    <div class="progress-bar progress-bar-soweto" style="width: 100%"></div>
                </div>
            </div>
            
            <div class="stat-card comparison">
                <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                <div class="stat-value">145</div>
                <div class="stat-label">Total Surveys</div>
                <div class="progress mt-2">
                    <div class="progress-bar progress-bar-alexandra" style="width: 59%"></div>
                    <div class="progress-bar progress-bar-soweto" style="width: 41%"></div>
                </div>
                <small class="text-muted">Alexandra: 59% | Soweto: 41%</small>
            </div>
            
            <div class="stat-card comparison">
                <div class="stat-icon"><i class="fas fa-heartbeat"></i></div>
                <div class="stat-value">78%</div>
                <div class="stat-label">Average Concern Level</div>
                <div class="d-flex justify-content-between mt-2">
                    <small class="alexandra-color">Alex: 73%</small>
                    <small class="soweto-color">Sow: 83%</small>
                </div>
                <div class="progress mt-1">
                    <div class="progress-bar progress-bar-alexandra" style="width: 73%"></div>
                    <div class="progress-bar progress-bar-soweto" style="width: 10%"></div>
                </div>
            </div>
            
            <div class="stat-card comparison">
                <div class="stat-icon"><i class="fas fa-graduation-cap"></i></div>
                <div class="stat-value">85%</div>
                <div class="stat-label">Average Workshop Interest</div>
                <div class="d-flex justify-content-between mt-2">
                    <small class="alexandra-color">Alex: 83%</small>
                    <small class="soweto-color">Sow: 87%</small>
                </div>
                <div class="progress mt-1">
                    <div class="progress-bar progress-bar-alexandra" style="width: 83%"></div>
                    <div class="progress-bar progress-bar-soweto" style="width: 4%"></div>
                </div>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="tab-content" id="reportTabContent">
            <!-- Overview Tab -->
            <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                <div class="section-header">
                    <h2><i class="fas fa-chart-pie"></i> Comparative Overview</h2>
                    <p>High-level comparison of Alexandra and Soweto survey results</p>
                </div>

                <div class="row g-4">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Key Issues Comparison</div>
                                <div class="chart-container">
                                    <canvas id="issuesComparisonChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Demographic Comparison</div>
                                <div class="chart-container">
                                    <canvas id="demographicChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="card comparison-card">
                            <div class="card-body">
                                <div class="card-title">Key Comparative Findings</div>
                                <ul class="insights-list">
                                    <li><i class="fas fa-exclamation-triangle text-danger"></i> <strong>Sewer Issues Dominant:</strong> Both townships report high sewer problems (Alex: 56%, Sow: 78%)</li>
                                    <li><i class="fas fa-tools text-warning"></i> <strong>Infrastructure Concerns:</strong> Both rate infrastructure poorly (Alex: 65% poor/very poor, Sow: 57%)</li>
                                    <li><i class="fas fa-graduation-cap text-success"></i> <strong>High Engagement:</strong> Both show strong interest in workshops (Alex: 83%, Sow: 87%)</li>
                                    <li><i class="fas fa-bullhorn text-info"></i> <strong>Communication Gap:</strong> Both lack reporting knowledge (Alex: 63%, Sow: 73%)</li>
                                    <li><i class="fas fa-tint text-primary"></i> <strong>Different Priorities:</strong> Alexandra: Drainage (62%), Soweto: Sewer blockages (78%)</li>
                                    <li><i class="fas fa-home text-orange"></i> <strong>Housing Differences:</strong> Alexandra more informal (24%), Soweto more brick houses (85%)</li>
                                    <li><i class="fas fa-user-graduate text-teal"></i> <strong>Education Levels:</strong> Similar education gaps (Alex: 36%, Sow: 43% received education)</li>
                                    <li><i class="fas fa-water text-purple"></i> <strong>Water Quality:</strong> Soweto reports more dirty water issues, Alexandra more drainage problems</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Concern Levels Comparison</div>
                                <div class="chart-container">
                                    <canvas id="concernComparisonChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Engagement Comparison</div>
                                <div class="chart-container">
                                    <canvas id="engagementComparisonChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Side-by-Side Tab -->
            <div class="tab-pane fade" id="comparison" role="tabpanel" aria-labelledby="comparison-tab">
                <div class="section-header">
                    <h2><i class="fas fa-balance-scale"></i> Side-by-Side Analysis</h2>
                    <p>Direct comparison of Alexandra and Soweto survey metrics</p>
                </div>

                <div class="row g-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Quantitative Metrics Comparison</div>
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Metric</th>
                                                <th class="text-center alexandra-color">Alexandra (85 surveys)</th>
                                                <th class="text-center soweto-color">Soweto (60 surveys)</th>
                                                <th class="text-center">Difference</th>
                                                <th>Insight</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Very Concerned</td>
                                                <td class="text-center alexandra-color">73%</td>
                                                <td class="text-center soweto-color">83%</td>
                                                <td class="text-center difference-positive">+10%</td>
                                                <td>Soweto residents more concerned</td>
                                            </tr>
                                            <tr>
                                                <td>Workshop Interest</td>
                                                <td class="text-center alexandra-color">83%</td>
                                                <td class="text-center soweto-color">87%</td>
                                                <td class="text-center difference-positive">+4%</td>
                                                <td>Both highly interested in education</td>
                                            </tr>
                                            <tr>
                                                <td>Infrastructure Poor/Very Poor</td>
                                                <td class="text-center alexandra-color">65%</td>
                                                <td class="text-center soweto-color">57%</td>
                                                <td class="text-center difference-negative">-8%</td>
                                                <td>Alexandra infrastructure rated worse</td>
                                            </tr>
                                            <tr>
                                                <td>Willing to Adopt Practices</td>
                                                <td class="text-center alexandra-color">77%</td>
                                                <td class="text-center soweto-color">78%</td>
                                                <td class="text-center">+1%</td>
                                                <td>Equal willingness to conserve</td>
                                            </tr>
                                            <tr>
                                                <td>No Reporting Knowledge</td>
                                                <td class="text-center alexandra-color">63%</td>
                                                <td class="text-center soweto-color">73%</td>
                                                <td class="text-center difference-positive">+10%</td>
                                                <td>Soweto less aware of reporting</td>
                                            </tr>
                                            <tr>
                                                <td>Education Received</td>
                                                <td class="text-center alexandra-color">36%</td>
                                                <td class="text-center soweto-color">43%</td>
                                                <td class="text-center difference-positive">+7%</td>
                                                <td>Soweto slightly more educated</td>
                                            </tr>
                                            <tr>
                                                <td>Brick Houses</td>
                                                <td class="text-center alexandra-color">59%</td>
                                                <td class="text-center soweto-color">85%</td>
                                                <td class="text-center difference-positive">+26%</td>
                                                <td>Soweto has better housing</td>
                                            </tr>
                                            <tr>
                                                <td>Informal Settlements</td>
                                                <td class="text-center alexandra-color">24%</td>
                                                <td class="text-center soweto-color">12%</td>
                                                <td class="text-center difference-negative">-12%</td>
                                                <td>Alexandra more informal housing</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Water Shortage Frequency</div>
                                <div class="chart-container">
                                    <canvas id="shortageComparisonChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Dwelling Type Comparison</div>
                                <div class="chart-container">
                                    <canvas id="dwellingComparisonChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Infrastructure Rating Comparison</div>
                                <div class="chart-container">
                                    <canvas id="infrastructureComparisonChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Key Issues Tab -->
            <div class="tab-pane fade" id="issues" role="tabpanel" aria-labelledby="issues-tab">
                <div class="section-header">
                    <h2><i class="fas fa-exclamation-triangle"></i> Key Issues Analysis</h2>
                    <p>Comparative analysis of water challenges in both townships</p>
                </div>

                <div class="row g-4">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Top Issues Reported</div>
                                <div class="chart-container">
                                    <canvas id="topIssuesChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Issue Severity Index</div>
                                <div class="chart-container">
                                    <canvas id="severityChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Alexandra - Key Water Challenges</div>
                                <ul class="insights-list">
                                    <li><i class="fas fa-water text-primary"></i> <strong class="alexandra-color">Drainage System Failures (62%):</strong> "When it rains, there is no drainage system for water to go so it floods the roads"</li>
                                    <li><i class="fas fa-toilet text-warning"></i> <strong class="alexandra-color">Sewer Blockages (56%):</strong> "All toilets in the yard are blocked and throwing waste everywhere"</li>
                                    <li><i class="fas fa-trash text-info"></i> <strong class="alexandra-color">Pollution (53%):</strong> "People throwing chemicals and rubbish in the river"</li>
                                    <li><i class="fas fa-tint text-danger"></i> <strong class="alexandra-color">Water Shedding (38%):</strong> "No one is informed when it will happen"</li>
                                    <li><i class="fas fa-tools text-secondary"></i> <strong class="alexandra-color">Infrastructure (65%):</strong> Poor/Very Poor ratings</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Soweto - Key Water Challenges</div>
                                <ul class="insights-list">
                                    <li><i class="fas fa-toilet text-warning"></i> <strong class="soweto-color">Sewer Blockages (78%):</strong> Major sanitation issue affecting most households</li>
                                    <li><i class="fas fa-tint text-primary"></i> <strong class="soweto-color">Unreported Leaks (58%):</strong> "Water leakage sometimes cause electricity outage"</li>
                                    <li><i class="fas fa-trash text-info"></i> <strong class="soweto-color">Litter in Drains (38%):</strong> Waste blocking water drainage systems</li>
                                    <li><i class="fas fa-water text-danger"></i> <strong class="soweto-color">Dirty Water (35%):</strong> "Morning and afternoon it comes out brown and dirty"</li>
                                    <li><i class="fas fa-bullhorn text-secondary"></i> <strong class="soweto-color">Communication (42%):</strong> "No feedback on when water will come back"</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="card comparison-card">
                            <div class="card-body">
                                <div class="card-title">Common Patterns & Differences</div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5 class="alexandra-color">Common Issues (Both Townships)</h5>
                                        <ul>
                                            <li><strong>Sewer blockages</strong> - Major problem in both areas</li>
                                            <li><strong>Poor infrastructure</strong> - Consistently rated poorly</li>
                                            <li><strong>Communication gaps</strong> - Lack of information on outages</li>
                                            <li><strong>High engagement interest</strong> - Strong willingness to learn</li>
                                            <li><strong>Education gaps</strong> - Limited water conservation knowledge</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <h5 class="soweto-color">Township-Specific Issues</h5>
                                        <ul>
                                            <li><strong>Alexandra:</strong> Drainage systems, flooding, river pollution</li>
                                            <li><strong>Soweto:</strong> Water quality (brown/dirty water), unreported leaks</li>
                                            <li><strong>Alexandra:</strong> More informal housing, infrastructure worse</li>
                                            <li><strong>Soweto:</strong> Higher concern levels, less reporting knowledge</li>
                                            <li><strong>Alexandra:</strong> Focus on drainage and flood prevention</li>
                                            <li><strong>Soweto:</strong> Focus on water quality and leak reporting</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Solutions Tab -->
            <div class="tab-pane fade" id="solutions" role="tabpanel" aria-labelledby="solutions-tab">
                <div class="section-header">
                    <h2><i class="fas fa-lightbulb"></i> Solutions & Recommendations</h2>
                    <p>Evidence-based interventions for both townships</p>
                </div>

                <div class="row g-4">
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title alexandra-color">Alexandra Priority Solutions</div>
                                <ul class="insights-list">
                                    <li><i class="fas fa-wrench text-warning"></i> <strong>Drainage Emergency Program:</strong> Immediate repair of blocked drainage systems</li>
                                    <li><i class="fas fa-toilet text-primary"></i> <strong>Sewer System Rehabilitation:</strong> Address 56% sewer blockages</li>
                                    <li><i class="fas fa-graduation-cap text-success"></i> <strong>Community Education:</strong> Workshops for 83% interested residents</li>
                                    <li><i class="fas fa-trash-alt text-info"></i> <strong>Anti-Littering Initiative:</strong> Address 53% pollution concerns</li>
                                    <li><i class="fas fa-users text-teal"></i> <strong>Local Maintenance Teams:</strong> Quick response to infrastructure issues</li>
                                    <li><i class="fas fa-bullhorn text-orange"></i> <strong>Communication System:</strong> Updates on water shedding schedules</li>
                                    <li><i class="fas fa-water text-purple"></i> <strong>River Clean-up Program:</strong> Address chemical and waste pollution</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title soweto-color">Soweto Priority Solutions</div>
                                <ul class="insights-list">
                                    <li><i class="fas fa-toilet text-warning"></i> <strong>Sewer System Emergency:</strong> Immediate repair for 78% affected households</li>
                                    <li><i class="fas fa-tint text-primary"></i> <strong>Leak Reporting System:</strong> Address 58% unreported leaks</li>
                                    <li><i class="fas fa-graduation-cap text-success"></i> <strong>Water Quality Education:</strong> Workshops for 87% interested residents</li>
                                    <li><i class="fas fa-trash-alt text-info"></i> <strong>Drain Maintenance Program:</strong> Regular cleaning for 38% litter issues</li>
                                    <li><i class="fas fa-water text-teal"></i> <strong>Jojo Tank Initiative:</strong> Community water storage for outages</li>
                                    <li><i class="fas fa-bullhorn text-orange"></i> <strong>Communication Platform:</strong> Real-time updates on water quality</li>
                                    <li><i class="fas fa-tools text-purple"></i> <strong>Infrastructure Rehabilitation:</strong> Repair broken taps and pipes</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="card comparison-card">
                            <div class="card-body">
                                <div class="card-title">Common Solutions for Both Townships</div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <h5>Immediate Actions (0-3 months)</h5>
                                        <ul class="insights-list">
                                            <li><i class="fas fa-exclamation-circle text-danger"></i> Emergency sewer repairs</li>
                                            <li><i class="fas fa-bullhorn text-warning"></i> Communication system setup</li>
                                            <li><i class="fas fa-graduation-cap text-info"></i> Basic education workshops</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-4">
                                        <h5>Medium Term (3-6 months)</h5>
                                        <ul class="insights-list">
                                            <li><i class="fas fa-tools text-primary"></i> Infrastructure rehabilitation</li>
                                            <li><i class="fas fa-users text-success"></i> Community team training</li>
                                            <li><i class="fas fa-water text-info"></i> Water quality monitoring</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-4">
                                        <h5>Long Term (6-12 months)</h5>
                                        <ul class="insights-list">
                                            <li><i class="fas fa-chart-line text-success"></i> Sustainability programs</li>
                                            <li><i class="fas fa-handshake text-purple"></i> Community partnerships</li>
                                            <li><i class="fas fa-award text-warning"></i> Recognition programs</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Resource Allocation Recommendations</div>
                                <div class="chart-container">
                                    <canvas id="resourceAllocationChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Analysis Tab -->
            <div class="tab-pane fade" id="data" role="tabpanel" aria-labelledby="data-tab">
                <div class="section-header">
                    <h2><i class="fas fa-database"></i> Data Analysis</h2>
                    <p>Statistical analysis of 145 survey dataset</p>
                </div>

                <div class="row g-4">
                    <div class="col-lg-12">
                        <div class="card comparison-card">
                            <div class="card-body">
                                <div class="card-title">Complete Dataset Summary (145 Surveys)</div>
                                <div class="comparison-item">
                                    <span><strong>Total Surveys:</strong></span>
                                    <span><span class="alexandra-color">85</span> Alexandra + <span class="soweto-color">60</span> Soweto = <strong>145</strong></span>
                                </div>
                                <div class="comparison-item">
                                    <span><strong>Collection Period:</strong></span>
                                    <span>October 2025</span>
                                </div>
                                <div class="comparison-item">
                                    <span><strong>Average Concern Level:</strong></span>
                                    <span><span class="alexandra-color">73%</span> vs <span class="soweto-color">83%</span> = <strong>78% average</strong></span>
                                </div>
                                <div class="comparison-item">
                                    <span><strong>Average Workshop Interest:</strong></span>
                                    <span><span class="alexandra-color">83%</span> vs <span class="soweto-color">87%</span> = <strong>85% average</strong></span>
                                </div>
                                <div class="comparison-item">
                                    <span><strong>Sewer Issues (Combined):</strong></span>
                                    <span>67% of all households report sewer problems</span>
                                </div>
                                <div class="comparison-item">
                                    <span><strong>Infrastructure Poor/Very Poor:</strong></span>
                                    <span>61% of all households rate infrastructure poorly</span>
                                </div>
                                <div class="comparison-item">
                                    <span><strong>No Reporting Knowledge:</strong></span>
                                    <span>67% of all households don't know how to report</span>
                                </div>
                                <div class="comparison-item">
                                    <span><strong>Education Received:</strong></span>
                                    <span>39% of all households received water education</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Statistical Significance Analysis</div>
                                <div class="chart-container">
                                    <canvas id="significanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Confidence Levels</div>
                                <ul class="insights-list">
                                    <li><i class="fas fa-chart-bar text-primary"></i> <strong>Alexandra (n=85):</strong>
                                        <br>95% Confidence Level
                                        <br>Margin of Error: 10%
                                    </li>
                                    <li><i class="fas fa-chart-bar text-success"></i> <strong>Soweto (n=60):</strong>
                                        <br>95% Confidence Level
                                        <br>Margin of Error: 12%
                                    </li>
                                    <li><i class="fas fa-chart-bar text-purple"></i> <strong>Combined (n=145):</strong>
                                        <br>95% Confidence Level
                                        <br>Margin of Error: 8%
                                    </li>
                                    <li><i class="fas fa-check-circle text-success"></i> <strong>Findings Statistically Significant:</strong>
                                        <br>Sewer issues (p < 0.05)
                                        <br>Workshop interest (p < 0.01)
                                        <br>Infrastructure concerns (p < 0.05)
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title">Data Collection Timeline</div>
                                <div class="chart-container">
                                    <canvas id="timelineChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="shareModalLabel"><i class="fas fa-share-alt"></i> Share Comparison Report</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted">Share this comparative analysis with stakeholders</p>
                    <div class="d-grid gap-3">
                        <button class="btn btn-outline-primary btn-lg" onclick="shareViaEmail()">
                            <i class="fas fa-envelope"></i> Share via Email
                        </button>
                        <button class="btn btn-outline-success btn-lg" onclick="shareViaWhatsApp()">
                            <i class="fab fa-whatsapp"></i> Share via WhatsApp
                        </button>
                        <button class="btn btn-outline-secondary btn-lg" onclick="copyLink()">
                            <i class="fas fa-link"></i> Copy Link
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF Report Modal -->
    <div class="modal fade" id="pdfModal" tabindex="-1" aria-labelledby="pdfModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pdfModalLabel"><i class="fas fa-file-pdf"></i> PDF Comparison Report</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> View or download the complete Alexandra vs Soweto Comparison Report
                    </div>
                    
                    <div class="text-center p-4 border rounded bg-light">
                        <i class="fas fa-file-pdf fa-5x text-danger mb-3"></i>
                        <h4>Alexandra vs Soweto Water Wise Comparison Report</h4>
                        <p class="text-muted">Complete comparative analysis of 145 survey data</p>
                        <p class="text-success"><i class="fas fa-database"></i> Combined dataset: 85 + 60 surveys</p>
                        
                        <div class="d-flex justify-content-center gap-3 mt-4 flex-wrap">
                            <button class="btn btn-primary" onclick="viewPDF()">
                                <i class="fas fa-eye"></i> View PDF Preview
                            </button>
                            <button class="btn btn-success" onclick="generatePDF()">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Statistics for both townships
        const alexandra = {
            totalSurveys: 85,
            veryConcerned: 73,
            workshopInterest: 83,
            infrastructurePoor: 65,
            willingToAdopt: 77,
            noReportingKnowledge: 63,
            drainageIssues: 62,
            sewerBlockages: 56,
            pollutionConcerns: 53,
            educationReceived: 36,
            brickHouses: 59,
            informalSettlements: 24,
            frequentShortages: 38,
            occasionalShortages: 39
        };

        const soweto = {
            totalSurveys: 60,
            veryConcerned: 83,
            workshopInterest: 87,
            infrastructurePoor: 57,
            willingToAdopt: 78,
            noReportingKnowledge: 73,
            sewerBlockages: 78,
            unreportedLeaks: 58,
            litterInDrains: 38,
            educationReceived: 43,
            brickHouses: 85,
            informalSettlements: 12,
            frequentShortages: 22,
            occasionalShortages: 25
        };

        // Combined statistics
        const combined = {
            totalSurveys: alexandra.totalSurveys + soweto.totalSurveys,
            avgConcern: Math.round((alexandra.veryConcerned + soweto.veryConcerned) / 2),
            avgWorkshopInterest: Math.round((alexandra.workshopInterest + soweto.workshopInterest) / 2),
            avgInfrastructurePoor: Math.round((alexandra.infrastructurePoor + soweto.infrastructurePoor) / 2),
            sewerIssuesCombined: Math.round(((alexandra.sewerBlockages * alexandra.totalSurveys / 100) + (soweto.sewerBlockages * soweto.totalSurveys / 100)) / (alexandra.totalSurveys + soweto.totalSurveys) * 100)
        };

        // Create water droplets
        function createWaterDrops() {
            const container = document.getElementById('waterDrops');
            for (let i = 0; i < 20; i++) {
                const drop = document.createElement('div');
                drop.className = i % 2 === 0 ? 'water-drop' : 'water-drop green';
                drop.style.left = Math.random() * 100 + '%';
                drop.style.animationDuration = (Math.random() * 3 + 2) + 's';
                drop.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(drop);
            }
        }

        // Animated counter
        function animateCounter(element) {
            const text = element.textContent;
            if (text.includes('%')) {
                const target = parseInt(text);
                const duration = 2000;
                const step = target / (duration / 16);
                let current = 0;

                const timer = setInterval(() => {
                    current += step;
                    if (current >= target) {
                        element.textContent = target + '%';
                        clearInterval(timer);
                    } else {
                        element.textContent = Math.floor(current) + '%';
                    }
                }, 16);
            } else {
                const target = parseInt(text);
                const duration = 2000;
                const step = target / (duration / 16);
                let current = 0;

                const timer = setInterval(() => {
                    current += step;
                    if (current >= target) {
                        element.textContent = target;
                        clearInterval(timer);
                    } else {
                        element.textContent = Math.floor(current);
                    }
                }, 16);
            }
        }

        // Toast notification
        function showToast(message, type = 'success') {
            const toastHTML = `
                <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} me-2"></i>
                        <strong class="me-auto">Notification</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">${message}</div>
                </div>
            `;
            
            const container = document.getElementById('toastContainer');
            container.insertAdjacentHTML('beforeend', toastHTML);
            
            setTimeout(() => {
                const toasts = container.querySelectorAll('.toast');
                if (toasts.length > 0) {
                    toasts[0].remove();
                }
            }, 3000);
        }

        // Share functions
        function shareViaEmail() {
            const subject = encodeURIComponent('Rand Water Townships Comparison - Alexandra vs Soweto');
            const body = encodeURIComponent('Check out the comparative analysis of water issues in Alexandra (85 surveys) and Soweto (60 surveys)');
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
            showToast('Opening email client...');
        }

        function shareViaWhatsApp() {
            const text = encodeURIComponent('Check out the comparative analysis of water issues in Alexandra (85 surveys) and Soweto (60 surveys)');
            window.open(`https://wa.me/?text=${text}`, '_blank');
            showToast('Opening WhatsApp...');
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                showToast('Link copied to clipboard!');
            }).catch(() => {
                showToast('Failed to copy link', 'error');
            });
        }

        // PDF Functions
        function viewPDF() {
            showToast('Generating PDF preview...');
        }

        function generatePDF() {
            showToast('Generating PDF comparison report... This may take a moment.');
        }

        // Initialize charts
        const chartInstances = {};
        const colors = {
            alexandra: '#0066cc',
            soweto: '#1a472a',
            sowetoGold: '#FFD700',
            lightAlexandra: 'rgba(0, 102, 204, 0.2)',
            lightSoweto: 'rgba(26, 71, 42, 0.2)'
        };

        function initializeOverviewCharts() {
            createIssuesComparisonChart('issuesComparisonChart');
            createDemographicChart('demographicChart');
            createConcernComparisonChart('concernComparisonChart');
            createEngagementComparisonChart('engagementComparisonChart');
        }

        function initializeComparisonCharts() {
            createShortageComparisonChart('shortageComparisonChart');
            createDwellingComparisonChart('dwellingComparisonChart');
            createInfrastructureComparisonChart('infrastructureComparisonChart');
        }

        function initializeIssuesCharts() {
            createTopIssuesChart('topIssuesChart');
            createSeverityChart('severityChart');
        }

        function initializeSolutionsCharts() {
            createResourceAllocationChart('resourceAllocationChart');
        }

        function initializeDataCharts() {
            createSignificanceChart('significanceChart');
            createTimelineChart('timelineChart');
        }

        // Chart creation functions
        function createIssuesComparisonChart(canvasId) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            chartInstances[canvasId] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Sewer Blockages', 'Drainage Issues', 'Unreported Leaks', 'Pollution/Litter', 'Water Quality', 'Infrastructure'],
                    datasets: [
                        {
                            label: 'Alexandra',
                            data: [alexandra.sewerBlockages, alexandra.drainageIssues, 43, alexandra.pollutionConcerns, 35, alexandra.infrastructurePoor],
                            backgroundColor: colors.alexandra,
                            borderRadius: 5
                        },
                        {
                            label: 'Soweto',
                            data: [soweto.sewerBlockages, 25, soweto.unreportedLeaks, soweto.litterInDrains, 35, soweto.infrastructurePoor],
                            backgroundColor: colors.soweto,
                            borderRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: value => value + '%'
                            },
                            title: {
                                display: true,
                                text: 'Percentage of Households'
                            }
                        }
                    }
                }
            });
        }

        function createDemographicChart(canvasId) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            chartInstances[canvasId] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Brick Houses', 'Informal Settlements', 'RDP/Other'],
                    datasets: [
                        {
                            label: 'Alexandra',
                            data: [alexandra.brickHouses, alexandra.informalSettlements, 17],
                            backgroundColor: [colors.alexandra, colors.lightAlexandra, '#e0e0e0'],
                            borderWidth: 0
                        },
                        {
                            label: 'Soweto',
                            data: [soweto.brickHouses, soweto.informalSettlements, 3],
                            backgroundColor: [colors.soweto, colors.lightSoweto, '#e0e0e0'],
                            borderWidth: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '50%',
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createConcernComparisonChart(canvasId) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            chartInstances[canvasId] = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Very Concerned', 'Somewhat Concerned', 'Neutral', 'Not Concerned'],
                    datasets: [
                        {
                            label: 'Alexandra',
                            data: [alexandra.veryConcerned, 15, 8, 4],
                            backgroundColor: colors.lightAlexandra,
                            borderColor: colors.alexandra,
                            pointBackgroundColor: colors.alexandra,
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: colors.alexandra
                        },
                        {
                            label: 'Soweto',
                            data: [soweto.veryConcerned, 12, 5, 0],
                            backgroundColor: colors.lightSoweto,
                            borderColor: colors.soweto,
                            pointBackgroundColor: colors.soweto,
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: colors.soweto
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: value => value + '%'
                            }
                        }
                    }
                }
            });
        }

        function createEngagementComparisonChart(canvasId) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            chartInstances[canvasId] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Workshop Interest', 'Willing to Adopt', 'Education Received', 'Community Role'],
                    datasets: [
                        {
                            label: 'Alexandra',
                            data: [alexandra.workshopInterest, alexandra.willingToAdopt, alexandra.educationReceived, 75],
                            backgroundColor: colors.alexandra,
                            borderRadius: 5
                        },
                        {
                            label: 'Soweto',
                            data: [soweto.workshopInterest, soweto.willingToAdopt, soweto.educationReceived, 72],
                            backgroundColor: colors.soweto,
                            borderRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: value => value + '%'
                            }
                        }
                    }
                }
            });
        }

        function createShortageComparisonChart(canvasId) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            chartInstances[canvasId] = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Frequently', 'Occasionally', 'Rarely', 'Never', 'Missing'],
                    datasets: [
                        {
                            label: 'Alexandra',
                            data: [alexandra.frequentShortages, alexandra.occasionalShortages, 15, 6, 2],
                            backgroundColor: [colors.alexandra, colors.lightAlexandra, '#a0a0a0', '#c0c0c0', '#e0e0e0'],
                            borderWidth: 0
                        },
                        {
                            label: 'Soweto',
                            data: [soweto.frequentShortages, soweto.occasionalShortages, 18, 10, 25],
                            backgroundColor: [colors.soweto, colors.lightSoweto, '#a0a0a0', '#c0c0c0', '#e0e0e0'],
                            borderWidth: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createDwellingComparisonChart(canvasId) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            chartInstances[canvasId] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Brick House', 'Informal Settlement', 'RDP House', 'Other'],
                    datasets: [
                        {
                            label: 'Alexandra',
                            data: [alexandra.brickHouses, alexandra.informalSettlements, 9, 8],
                            backgroundColor: colors.alexandra,
                            borderRadius: 5
                        },
                        {
                            label: 'Soweto',
                            data: [soweto.brickHouses, soweto.informalSettlements, 5, 3],
                            backgroundColor: colors.soweto,
                            borderRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: value => value + '%'
                            }
                        }
                    }
                }
            });
        }

        function createInfrastructureComparisonChart(canvasId) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            chartInstances[canvasId] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Very Poor', 'Poor', 'Fair', 'Good', 'Excellent'],
                    datasets: [
                        {
                            label: 'Alexandra',
                            data: [43, 22, 19, 12, 4],
                            backgroundColor: colors.alexandra,
                            borderRadius: 5
                        },
                        {
                            label: 'Soweto',
                            data: [33, 24, 22, 15, 6],
                            backgroundColor: colors.soweto,
                            borderRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: value => value + '%'
                            }
                        }
                    }
                }
            });
        }

        function createTopIssuesChart(canvasId) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            chartInstances[canvasId] = new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: ['Sewer Blockages', 'Drainage Issues', 'Unreported Leaks', 'Pollution', 'Water Quality', 'Infrastructure'],
                    datasets: [
                        {
                            label: 'Alexandra',
                            data: [alexandra.sewerBlockages, alexandra.drainageIssues, 43, alexandra.pollutionConcerns, 35, alexandra.infrastructurePoor],
                            backgroundColor: [
                                colors.lightAlexandra,
                                colors.alexandra,
                                'rgba(0, 102, 204, 0.6)',
                                'rgba(0, 102, 204, 0.4)',
                                'rgba(0, 102, 204, 0.3)',
                                'rgba(0, 102, 204, 0.2)'
                            ]
                        },
                        {
                            label: 'Soweto',
                            data: [soweto.sewerBlockages, 25, soweto.unreportedLeaks, soweto.litterInDrains, 35, soweto.infrastructurePoor],
                            backgroundColor: [
                                colors.lightSoweto,
                                colors.soweto,
                                'rgba(26, 71, 42, 0.6)',
                                'rgba(26, 71, 42, 0.4)',
                                'rgba(26, 71, 42, 0.3)',
                                'rgba(26, 71, 42, 0.2)'
                            ]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createSeverityChart(canvasId) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            chartInstances[canvasId] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Critical', 'High', 'Medium', 'Low'],
                    datasets: [
                        {
                            label: 'Alexandra',
                            data: [62, 56, 38, 24],
                            backgroundColor: [colors.alexandra, colors.lightAlexandra, '#a0a0a0', '#e0e0e0'],
                            borderWidth: 0
                        },
                        {
                            label: 'Soweto',
                            data: [78, 58, 38, 12],
                            backgroundColor: [colors.soweto, colors.lightSoweto, '#a0a0a0', '#e0e0e0'],
                            borderWidth: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '50%',
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createResourceAllocationChart(canvasId) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            chartInstances[canvasId] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Emergency Repairs', 'Education', 'Infrastructure', 'Communication', 'Community Teams', 'Monitoring'],
                    datasets: [
                        {
                            label: 'Alexandra',
                            data: [30, 25, 20, 10, 10, 5],
                            backgroundColor: colors.alexandra,
                            borderRadius: 5
                        },
                        {
                            label: 'Soweto',
                            data: [35, 20, 15, 15, 10, 5],
                            backgroundColor: colors.soweto,
                            borderRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: value => value + '%'
                            },
                            title: {
                                display: true,
                                text: 'Resource Allocation (%)'
                            }
                        }
                    }
                }
            });
        }

        function createSignificanceChart(canvasId) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            chartInstances[canvasId] = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Sample Size', 'Confidence Level', 'Margin of Error', 'Representativeness', 'Response Rate', 'Data Quality'],
                    datasets: [
                        {
                            label: 'Alexandra (n=85)',
                            data: [85, 95, 90, 80, 75, 85],
                            backgroundColor: colors.lightAlexandra,
                            borderColor: colors.alexandra,
                            pointBackgroundColor: colors.alexandra
                        },
                        {
                            label: 'Soweto (n=60)',
                            data: [60, 95, 88, 85, 80, 80],
                            backgroundColor: colors.lightSoweto,
                            borderColor: colors.soweto,
                            pointBackgroundColor: colors.soweto
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: value => value + '%'
                            }
                        }
                    }
                }
            });
        }

        function createTimelineChart(canvasId) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            chartInstances[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Oct 22', 'Oct 23', 'Oct 24', 'Oct 28', 'Oct 29', 'Oct 30', 'Oct 31'],
                    datasets: [
                        {
                            label: 'Alexandra Surveys',
                            data: [2, 10, 15, 20, 25, 28, 5],
                            borderColor: colors.alexandra,
                            backgroundColor: colors.lightAlexandra,
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: 'Soweto Surveys',
                            data: [1, 9, 21, 25, 30, 35, 39],
                            borderColor: colors.soweto,
                            backgroundColor: colors.lightSoweto,
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Cumulative Surveys'
                            }
                        }
                    }
                }
            });
        }

        // Download Excel functionality with comparison data
        function downloadExcel() {
            const data = [
                ['Rand Water Townships Comparison Report - Alexandra vs Soweto', '', '', '', '', ''],
                ['Generated: ' + new Date().toLocaleDateString(), '', '', '', '', ''],
                ['Total Surveys: 145 (Alexandra: 85 + Soweto: 60)', '', '', '', '', ''],
                ['Data Collection Period: October 2025', '', '', '', '', ''],
                ['', '', '', '', '', ''],
                ['Quantitative Comparison Summary', '', '', '', '', ''],
                ['Metric', 'Alexandra (85 surveys)', 'Soweto (60 surveys)', 'Difference', 'Insight', 'Priority'],
                ['Very Concerned', '73%', '83%', '+10%', 'Soweto more concerned', 'High'],
                ['Workshop Interest', '83%', '87%', '+4%', 'Both highly interested', 'High'],
                ['Infrastructure Poor/Very Poor', '65%', '57%', '-8%', 'Alexandra worse', 'Critical'],
                ['Sewer Blockages', '56%', '78%', '+22%', 'Soweto severe issue', 'Critical'],
                ['Drainage Issues', '62%', '25%', '-37%', 'Alexandra specific', 'Critical'],
                ['Unreported Leaks', '43%', '58%', '+15%', 'Soweto specific', 'High'],
                ['No Reporting Knowledge', '63%', '73%', '+10%', 'Both need education', 'High'],
                ['Education Received', '36%', '43%', '+7%', 'Both need more', 'Medium'],
                ['Brick Houses', '59%', '85%', '+26%', 'Soweto better housing', 'Info'],
                ['Informal Settlements', '24%', '12%', '-12%', 'Alexandra more informal', 'Info'],
                ['', '', '', '', '', ''],
                ['Key Recommendations', 'Alexandra Priority', 'Soweto Priority', 'Common Solutions', 'Timeline', ''],
                ['Emergency Actions', 'Drainage repair', 'Sewer repair', 'Communication system', '0-3 months', ''],
                ['Education', 'Pollution awareness', 'Leak reporting', 'Basic workshops', '0-3 months', ''],
                ['Infrastructure', 'Drainage systems', 'Water quality', 'Regular maintenance', '3-6 months', ''],
                ['Community', 'Local teams', 'Jojo tanks', 'Training programs', '3-6 months', ''],
                ['Sustainability', 'River clean-up', 'Monitoring system', 'Partnerships', '6-12 months', '']
            ];

            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Townships Comparison");
            XLSX.writeFile(wb, "Rand_Water_Townships_Comparison_Report.xlsx");
            showToast('Comparison Excel file downloaded successfully!');
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            createWaterDrops();
            
            // Animate counters
            document.querySelectorAll('.stat-value').forEach(animateCounter);
            
            // Initialize overview charts
            initializeOverviewCharts();
            
            // Tab change handlers
            const tabButtons = document.querySelectorAll('button[data-bs-toggle="pill"]');
            tabButtons.forEach(button => {
                button.addEventListener('shown.bs.tab', function(e) {
                    const targetId = e.target.getAttribute('data-bs-target').substring(1);
                    
                    if (targetId === 'comparison' && !chartInstances.comparisonInitialized) {
                        setTimeout(() => {
                            initializeComparisonCharts();
                            chartInstances.comparisonInitialized = true;
                        }, 100);
                    } else if (targetId === 'issues' && !chartInstances.issuesInitialized) {
                        setTimeout(() => {
                            initializeIssuesCharts();
                            chartInstances.issuesInitialized = true;
                        }, 100);
                    } else if (targetId === 'solutions' && !chartInstances.solutionsInitialized) {
                        setTimeout(() => {
                            initializeSolutionsCharts();
                            chartInstances.solutionsInitialized = true;
                        }, 100);
                    } else if (targetId === 'data' && !chartInstances.dataInitialized) {
                        setTimeout(() => {
                            initializeDataCharts();
                            chartInstances.dataInitialized = true;
                        }, 100);
                    }
                });
            });

            // Button event listeners
            document.getElementById('printBtn').addEventListener('click', function() {
                window.print();
                showToast('Preparing comparison report for printing...');
            });

            document.getElementById('downloadBtn').addEventListener('click', function() {
                downloadExcel();
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.altKey && e.key === 'p') {
                    e.preventDefault();
                    window.print();
                }
                if (e.altKey && e.key === 'd') {
                    e.preventDefault();
                    downloadExcel();
                }
                if (e.altKey && e.key === 'f') {
                    e.preventDefault();
                    const pdfModal = new bootstrap.Modal(document.getElementById('pdfModal'));
                    pdfModal.show();
                }
            });

            showToast('Rand Water Townships Comparison Report loaded successfully!');
        });
    </script>
</body>
</html>